# restclient Examples
# This file demonstrates the features of restclient using JSONPlaceholder API.
# https://jsonplaceholder.typicode.com

@baseUrl = https://jsonplaceholder.typicode.com

###############################################################################
# BASIC REQUESTS
###############################################################################

### Simple GET request
# @name getPosts
GET {{baseUrl}}/posts
Accept: application/json

### GET a single resource
# @name getPost
GET {{baseUrl}}/posts/1
Accept: application/json

### POST - Create a new resource
# @name createPost
POST {{baseUrl}}/posts
Content-Type: application/json

{
    "title": "My New Post",
    "body": "This is the content of my post",
    "userId": 1
}

### PUT - Update a resource
# @name updatePost
PUT {{baseUrl}}/posts/1
Content-Type: application/json

{
    "id": 1,
    "title": "Updated Title",
    "body": "Updated content",
    "userId": 1
}

### PATCH - Partial update
# @name patchPost
PATCH {{baseUrl}}/posts/1
Content-Type: application/json

{
    "title": "Patched Title Only"
}

### DELETE a resource
# @name deletePost
DELETE {{baseUrl}}/posts/1

###############################################################################
# QUERY PARAMETERS
###############################################################################

### Multi-line query parameters
# @name queryPosts
GET {{baseUrl}}/posts
    ?userId=1
    &_limit=5
    &_page=1
Accept: application/json

### Nested resources
# @name getUserPosts
GET {{baseUrl}}/users/1/posts
Accept: application/json

### Filtering with query
# @name filterTodos
GET {{baseUrl}}/todos?completed=true&userId=1
Accept: application/json

###############################################################################
# USER INPUT VARIABLES ({{:paramName}})
# These prompt you for values interactively
###############################################################################

### Dynamic path parameter
# @name getPostById
# Prompts for: id
GET {{baseUrl}}/posts/{{:id}}
Accept: application/json

### Dynamic query parameters
# @name searchPosts
# Prompts for: userId, limit
GET {{baseUrl}}/posts
    ?userId={{:userId}}
    &_limit={{:limit}}
Accept: application/json

### User input in request body
# @name createDynamicPost
# Prompts for: title, content, authorId
POST {{baseUrl}}/posts
Content-Type: application/json

{
    "title": "{{:title}}",
    "body": "{{:content}}",
    "userId": {{:authorId}}
}

### Shared user input across URL and body
# @name updateDynamicPost
# Prompts for: postId (used in URL and body), newTitle, newBody
PUT {{baseUrl}}/posts/{{:id}}
Content-Type: application/json

{
    "id": {{:postId}},
    "title": "{{:newTitle}}",
    "body": "{{:newBody}}",
    "userId": 1
}

###############################################################################
# SECRET USER INPUT ({{:paramName!secret}})
# Values are masked during entry and in CLI output
###############################################################################

### Secret in Authorization header
# @name authenticatedRequest
# Prompts for: apiToken (masked input)
GET {{baseUrl}}/posts/1
Accept: application/json
Authorization: Bearer {{:apiToken!secret}}

### Login with secret password
# @name loginExample
# Prompts for: username, password (password is masked)
POST {{baseUrl}}/posts
Content-Type: application/json

{
    "username": "{{:username}}",
    "password": "{{:password!secret}}",
    "action": "login"
}

### Multiple secrets
# @name multiSecretExample
# Prompts for: apiKey (masked), secretToken (masked), userId
GET {{baseUrl}}/users/{{:userId}}
Accept: application/json
X-API-Key: {{:apiKey!secret}}
X-Secret-Token: {{:secretToken!secret}}

###############################################################################
# SYSTEM VARIABLES
###############################################################################

### UUID and timestamps
# @name systemVariables
POST {{baseUrl}}/posts
Content-Type: application/json

{
    "id": "{{$guid}}",
    "timestamp": {{$timestamp}},
    "createdAt": "{{$datetime iso8601}}",
    "expiresAt": "{{$datetime iso8601 1 h}}",
    "localTime": "{{$localDatetime YYYY-MM-DD HH:mm:ss}}"
}

### Random values
# @name randomValues
POST {{baseUrl}}/posts
Content-Type: application/json

{
    "code": {{$randomInt 1000 9999}},
    "title": "Random Post {{$randomInt 1 100}}",
    "body": "Generated content",
    "userId": {{$randomInt 1 10}}
}

###############################################################################
# JAVASCRIPT SCRIPTING
###############################################################################

### Pre-request script
# @name preRequestScript
< {%
client.log("Preparing request...");
client.global.set("requestTime", $timestamp());
client.global.set("requestId", $uuid());
%}
GET {{baseUrl}}/posts/1
Accept: application/json
X-Request-Id: {{requestId}}

### Post-response script with tests
# @name postResponseTests
GET {{baseUrl}}/posts/1
Accept: application/json

> {%
client.test("Status is 200", function() {
    client.assert(response.status === 200, "Expected status 200");
});

client.test("Response has required fields", function() {
    client.assert(response.body.id !== undefined, "Missing id");
    client.assert(response.body.title !== undefined, "Missing title");
    client.assert(response.body.body !== undefined, "Missing body");
    client.assert(response.body.userId !== undefined, "Missing userId");
});

client.test("Content-Type is JSON", function() {
    var contentType = response.headers.valueOf("Content-Type");
    client.assert(contentType.includes("application/json"), "Expected JSON");
});

client.log("Post title: " + response.body.title);
%}

### Chaining requests with global variables
# @name chainStep1_GetUser
# First, get a user and store their ID
GET {{baseUrl}}/users/1
Accept: application/json

> {%
client.test("Got user successfully", function() {
    client.assert(response.status === 200);
});

// Store user info for the next request
client.global.set("userId", response.body.id);
client.global.set("userName", response.body.name);
client.log("Stored user: " + response.body.name);
%}

### Use stored values from previous request
# @name chainStep2_GetUserPosts
# Uses userId stored from chainStep1_GetUser
GET {{baseUrl}}/users/{{userId}}/posts
Accept: application/json

> {%
client.test("Got user posts", function() {
    client.assert(response.status === 200);
    client.assert(Array.isArray(response.body), "Expected array of posts");
});

var userName = client.global.get("userName");
client.log("Found " + response.body.length + " posts by " + userName);
%}

### Script utility functions
# @name scriptUtilities
POST {{baseUrl}}/posts
Content-Type: application/json

{
    "title": "Test Post",
    "body": "Testing utilities",
    "userId": 1
}

> {%
// Demonstrate built-in utility functions
var uuid = $uuid();
var timestamp = $timestamp();
var isoTime = $isoTimestamp();
var randomNum = $randomInt(1, 100);
var randomStr = $randomString(16);
var encoded = $base64("Hello, World!");
var decoded = $base64Decode(encoded);
var hash = $sha256(JSON.stringify(response.body));

client.log("UUID: " + uuid);
client.log("Timestamp: " + timestamp);
client.log("ISO Time: " + isoTime);
client.log("Random Number: " + randomNum);
client.log("Random String: " + randomStr);
client.log("Base64: " + encoded + " -> " + decoded);
client.log("Response Hash: " + hash);

// Store for potential use
client.global.set("lastResponseHash", hash);
%}

###############################################################################
# FORM DATA
###############################################################################

### URL-encoded form data
# @name formUrlEncoded
POST {{baseUrl}}/posts
Content-Type: application/x-www-form-urlencoded

title=Form Post
&body=Created from form data
&userId=1

### URL-encoded with user input
# @name formWithUserInput
# Prompts for: formTitle, formBody
POST {{baseUrl}}/posts
Content-Type: application/x-www-form-urlencoded

title={{:formTitle}}
&body={{:formBody}}
&userId=1

###############################################################################
# REQUEST VARIABLES (Response Chaining)
###############################################################################

### Create a post and capture the response
# @name createForChain
POST {{baseUrl}}/posts
Content-Type: application/json

{
    "title": "Chained Post",
    "body": "This post will be referenced",
    "userId": 1
}

### Reference the previous response using request variables
# @name useCreatedPost
# Uses the ID from createForChain response
GET {{baseUrl}}/posts/{{createForChain.response.body.$.id}}
Accept: application/json

###############################################################################
# COMPLETE WORKFLOW EXAMPLE
###############################################################################

### Full workflow with pre/post scripts and user input
# @name completeWorkflow
# Prompts for: searchUserId
< {%
// Pre-request: Set up timing and logging
var startTime = $timestamp();
client.global.set("workflowStart", startTime);
client.log("Starting workflow at " + $isoTimestamp());
client.log("Searching for user ID: {{:searchUserId}}");
%}
GET {{baseUrl}}/users/{{:searchUserId}}/todos
Accept: application/json

> {%
// Post-response: Validate and analyze
var endTime = $timestamp();
var startTime = client.global.get("workflowStart");
var duration = endTime - startTime;

client.test("Request successful", function() {
    client.assert(response.status === 200, "Expected 200 OK");
});

client.test("Response is array", function() {
    client.assert(Array.isArray(response.body), "Expected array");
});

// Analyze the todos
var todos = response.body;
var completed = todos.filter(function(t) { return t.completed; }).length;
var pending = todos.length - completed;

client.log("=== Workflow Results ===");
client.log("Duration: " + duration + "ms");
client.log("Total todos: " + todos.length);
client.log("Completed: " + completed);
client.log("Pending: " + pending);

// Store results
client.global.set("lastTodoCount", todos.length);
client.global.set("lastCompletedCount", completed);
%}

###############################################################################
# TIPS AND NOTES
###############################################################################

# Running examples:
#   restclient send examples/jsonplaceholder.http                    # Interactive selection
#   restclient send examples/jsonplaceholder.http -n getPosts        # By name
#   restclient send examples/jsonplaceholder.http -i 1               # By index
#   restclient send examples/jsonplaceholder.http --use-cached       # Reuse cached inputs
#   restclient send examples/jsonplaceholder.http --dry-run          # Preview without sending
#
# Session management:
#   restclient session show                                          # View current session
#   restclient session clear                                         # Clear session data
#   restclient send examples/jsonplaceholder.http --no-session       # Disable session
#   restclient send examples/jsonplaceholder.http --session my-test  # Named session
#
# History:
#   restclient history show                                          # View history
#   restclient history replay                                        # Replay a request
