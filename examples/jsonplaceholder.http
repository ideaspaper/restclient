### Comprehensive Examples
### This file demonstrates various request patterns including user input,
### scripting, and common malformed request scenarios with parser warnings.

@baseUrl = https://jsonplaceholder.typicode.com

###############################################################################
# BASIC REQUESTS (No User Input)
###############################################################################

### Simple GET request - no parameters
# @name simpleGet
GET {{baseUrl}}/posts/1
Accept: application/json

### GET with static query parameters
# @name staticQuery
GET {{baseUrl}}/posts?userId=1&_limit=5
Accept: application/json

### POST with static body
# @name staticPost
POST {{baseUrl}}/posts
Content-Type: application/json

{
    "title": "Static Title",
    "body": "This post has no dynamic content",
    "userId": 1
}

###############################################################################
# USER INPUT IN URL PATH AND QUERY ({{:paramName}})
###############################################################################

### GET with user input in path
# @name dynamicPath
# Prompts for: id
GET {{baseUrl}}/posts/{{:id}}
Accept: application/json

### GET with user input in query parameters
# @name dynamicQuery
# Prompts for: userId, page, limit
GET {{baseUrl}}/posts
    ?userId={{:userId}}
    &_page={{:page}}
    &_limit={{:limit}}
Accept: application/json

### GET with user input in both path and query
# @name dynamicPathAndQuery
# Prompts for: userId, completed
GET {{baseUrl}}/users/{{:userId}}/todos?completed={{:completed}}
Accept: application/json

### POST with user input in body
# @name dynamicBody
# Prompts for: title, body, authorId
POST {{baseUrl}}/posts
Content-Type: application/json

{
    "title": "{{:title}}",
    "body": "{{:body}}",
    "userId": {{:authorId}}
}

### PUT with user input in path and body
# @name dynamicUpdate
# Prompts for: postId, newTitle, newBody
PUT {{baseUrl}}/posts/{{:postId}}
Content-Type: application/json

{
    "id": {{:postId}},
    "title": "{{:newTitle}}",
    "body": "{{:newBody}}",
    "userId": 1
}

###############################################################################
# USER INPUT IN SCRIPTS
###############################################################################

### Pre-request script with user input
# @name scriptUserInput
# Prompts for: searchTerm (used in pre-request script)
< {%
// User input is available in scripts via global variables
var term = "{{:searchTerm}}";
client.log("Searching for: " + term);
client.global.set("searchTerm", term);
%}
GET {{baseUrl}}/posts
Accept: application/json

> {%
client.test("Search completed", function() {
    client.assert(response.status === 200);
});
client.log("Found " + response.body.length + " posts");
%}

### Dynamic test assertions with user input
# @name dynamicTest
# Prompts for: expectedId
GET {{baseUrl}}/posts/{{:expectedId}}
Accept: application/json

> {%
var expectedId = parseInt("{{:expectedId}}");
client.test("Response has correct ID", function() {
    client.assert(response.body.id === expectedId, 
        "Expected ID " + expectedId + " but got " + response.body.id);
});
%}

### User input for authentication header
# @name authWithUserInput
# Prompts for: apiToken
GET {{baseUrl}}/posts/1
Accept: application/json
Authorization: Bearer {{:apiToken}}

> {%
client.test("Request was authenticated", function() {
    client.assert(response.status === 200);
});
%}

###############################################################################
# MALFORMED REQUESTS - URL ISSUES
###############################################################################
# These requests demonstrate parser warnings for common URL mistakes

### Unknown HTTP method (typo: DELET instead of DELETE)
# @name malformedMethod
# Warning: unknown HTTP method 'DELET', defaulting to GET
DELET {{baseUrl}}/posts/1
Accept: application/json

### Another method typo (POSTT instead of POST)
# @name malformedMethodPost
# Warning: unknown HTTP method 'POSTT', defaulting to GET
POSTT {{baseUrl}}/posts
Content-Type: application/json

{
    "title": "This won't POST correctly",
    "body": "Method typo means this becomes GET",
    "userId": 1
}

###############################################################################
# MALFORMED REQUESTS - HEADER ISSUES
###############################################################################

### Header without colon separator
# @name malformedHeaderNoColon
# Warning: malformed header 'Authorization Bearer token' - missing colon
GET {{baseUrl}}/posts/1
Authorization Bearer token123
Accept: application/json

### Multiple malformed headers
# @name malformedHeadersMultiple
# Warning: multiple headers missing colons
GET {{baseUrl}}/posts/1
Content-Type application/json
Accept text/plain
Cache-Control no-cache

###############################################################################
# MALFORMED REQUESTS - BODY ISSUES
###############################################################################

### Body referencing non-existent file
# @name malformedBodyMissingFile
# Warning: file reference could not be read
POST {{baseUrl}}/posts
Content-Type: application/json

< ./data/nonexistent-payload.json

### Multiple file references with one missing
# @name malformedBodyPartialFile
# Warning: one file reference fails, others may succeed
POST {{baseUrl}}/posts
Content-Type: application/json

< ./missing-file.json

###############################################################################
# MALFORMED REQUESTS - SCRIPT ISSUES
###############################################################################

### Script with syntax error (unclosed brace)
# @name malformedScriptSyntax
GET {{baseUrl}}/posts/1
Accept: application/json

> {%
client.test("This has a syntax error", function() {
    client.assert(response.status === 200);
// Missing closing brace - this will cause runtime error
%}

### Script with undefined variable reference
# @name malformedScriptUndefined
GET {{baseUrl}}/posts/1
Accept: application/json

> {%
client.test("Undefined variable", function() {
    // undefinedVar is never declared
    client.assert(undefinedVar === true);
});
%}

### Pre-request script error
# @name malformedPreScript
< {%
// This will throw an error
throw new Error("Intentional pre-script error");
%}
GET {{baseUrl}}/posts/1
Accept: application/json

###############################################################################
# COMBINED MALFORMED - MULTIPLE ISSUES
###############################################################################

### Multiple issues in one request
# @name malformedCombined
# Warning: unknown method, malformed headers, missing file
DELET {{baseUrl}}/posts/1
Authorization Bearer token
Content-Type application/json

< ./nonexistent.json

### Method typo with script error
# @name malformedMethodAndScript
POSTT {{baseUrl}}/posts
Content-Type: application/json

{
    "title": "Test",
    "body": "Test body",
    "userId": 1
}

> {%
// Syntax error in post-response script
client.test("Will fail", function() {
    client.assert(response.status === 201)  // missing semicolon is ok
    // but this unclosed function is not
%}

###############################################################################
# VALID REQUESTS FOR COMPARISON
###############################################################################

### Valid DELETE request (correct spelling)
# @name validDelete
DELETE {{baseUrl}}/posts/1

### Valid POST with all correct syntax
# @name validPost
POST {{baseUrl}}/posts
Content-Type: application/json
Accept: application/json
Cache-Control: no-cache

{
    "title": "Valid Post",
    "body": "All syntax is correct",
    "userId": 1
}

> {%
client.test("Status is 201", function() {
    client.assert(response.status === 201, "Expected 201 Created");
});
client.log("Post created with ID: " + response.body.id);
%}

### Valid request with all features
# @name validComplete
# Prompts for: postId
< {%
client.log("Fetching post...");
var startTime = Date.now();
client.global.set("startTime", startTime);
%}
GET {{baseUrl}}/posts/{{:postId}}
Accept: application/json
Cache-Control: no-cache

> {%
var endTime = Date.now();
var startTime = client.global.get("startTime");
var duration = endTime - startTime;

client.test("Status is 200", function() {
    client.assert(response.status === 200);
});

client.test("Has valid post structure", function() {
    client.assert(response.body.id !== undefined);
    client.assert(response.body.title !== undefined);
    client.assert(response.body.body !== undefined);
    client.assert(response.body.userId !== undefined);
});

client.log("Request completed in " + duration + "ms");
client.log("Post title: " + response.body.title);
%}
